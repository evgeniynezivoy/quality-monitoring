# Инструкция по настройке доступа к MySQL для Quality Monitoring

## Обзор
Эта инструкция поможет настроить read-only доступ к базе данных MySQL для автоматического получения данных в систему Quality Monitoring.

---

## Часть 1: Исследование структуры базы данных

### Шаг 1.1: Войти в phpMyAdmin
1. Откройте phpMyAdmin в браузере
2. Войдите с админскими учетными данными

### Шаг 1.2: Посмотреть список баз данных
В левой панели phpMyAdmin вы увидите список баз данных. Нажмите на нужную базу данных.

**Или выполните SQL команду:**
Нажмите вкладку **"SQL"** вверху и введите:
```sql
SHOW DATABASES;
```
Нажмите **"Go"** (или "Выполнить")

### Шаг 1.3: Посмотреть список таблиц в базе
После выбора базы данных, выполните:
```sql
SHOW TABLES;
```

### Шаг 1.4: Посмотреть структуру конкретной таблицы
Замените `название_таблицы` на реальное название:
```sql
DESCRIBE название_таблицы;
```

**Или для просмотра всех полей с подробностями:**
```sql
SHOW FULL COLUMNS FROM название_таблицы;
```

### Шаг 1.5: Посмотреть примеры данных (первые 10 строк)
```sql
SELECT * FROM название_таблицы LIMIT 10;
```

---

## Часть 2: Обсуждение нужных полей

После выполнения Части 1, пожалуйста:
1. Сделайте скриншоты результатов команд DESCRIBE для каждой интересующей таблицы
2. Отправьте скриншоты для обсуждения
3. Мы вместе определим какие поля нужны

**Нам понадобится информация:**
- Название базы данных: `________________`
- Название таблицы (или таблиц): `________________`
- Список нужных полей: `________________`

---

## Часть 3: Создание пользователя и настройка доступа

### Шаг 3.1: Создать нового пользователя

**Данные для пользователя:**
- Имя пользователя: `quality_reader` (это НЕ email, просто логин)
- Пароль: `[ВСТАВИТЬ_ПАРОЛЬ]` (придумайте сложный пароль)
- Хост: `%` (доступ с любого IP) или конкретный IP если нужно ограничить

**Команда для создания пользователя:**
```sql
CREATE USER 'quality_reader'@'%' IDENTIFIED BY 'ВСТАВИТЬ_СЮДА_ПАРОЛЬ';
```

> **Важно:** Замените `ВСТАВИТЬ_СЮДА_ПАРОЛЬ` на реальный пароль!

### Шаг 3.2: Создать VIEW (представление) с нужными полями

VIEW — это "виртуальная таблица", которая показывает только те данные, которые мы разрешим.

**Шаблон команды (пример):**
```sql
CREATE VIEW quality_issues_view AS
SELECT
    поле1,
    поле2,
    поле3,
    поле4
FROM название_таблицы
WHERE условие_если_нужно;
```

**Реальный пример (заполнить после обсуждения полей):**
```sql
CREATE VIEW quality_issues_view AS
SELECT
    id,
    date,
    agent_name,
    issue_type,
    comment,
    severity
FROM issues_table;
```

### Шаг 3.3: Дать пользователю доступ к VIEW

```sql
GRANT SELECT ON название_базы.quality_issues_view TO 'quality_reader'@'%';
```

**Пример:**
```sql
GRANT SELECT ON my_database.quality_issues_view TO 'quality_reader'@'%';
```

### Шаг 3.4: Применить изменения

```sql
FLUSH PRIVILEGES;
```

---

## Часть 4: Проверка доступа

### Шаг 4.1: Проверить что VIEW создан
```sql
SHOW CREATE VIEW quality_issues_view;
```

### Шаг 4.2: Проверить что данные возвращаются
```sql
SELECT * FROM quality_issues_view LIMIT 5;
```

### Шаг 4.3: Проверить права пользователя
```sql
SHOW GRANTS FOR 'quality_reader'@'%';
```

---

## Часть 5: Информация для подключения

После выполнения всех шагов, пожалуйста предоставьте:

| Параметр | Значение |
|----------|----------|
| Хост (Host) | например: db.example.com или IP адрес |
| Порт (Port) | обычно 3306 |
| База данных (Database) | название базы |
| Пользователь (User) | quality_reader |
| Пароль (Password) | [сообщить отдельно безопасным способом] |
| Название VIEW | quality_issues_view |

---

## Возможные ошибки и решения

### Ошибка: "Access denied for user"
Проверьте что пользователь создан правильно:
```sql
SELECT User, Host FROM mysql.user WHERE User = 'quality_reader';
```

### Ошибка: "Unknown database"
Проверьте название базы данных:
```sql
SHOW DATABASES;
```

### Ошибка: "Table doesn't exist"
Проверьте название таблицы:
```sql
SHOW TABLES;
```

---

## Безопасность

- Пользователь `quality_reader` имеет ТОЛЬКО право на чтение (SELECT)
- Он может видеть ТОЛЬКО данные из созданного VIEW
- Он НЕ может изменять, удалять или добавлять данные
- Пароль передавайте только через защищенные каналы (не в email)

---

**Вопросы?** Свяжитесь с технической командой Quality Monitoring.
